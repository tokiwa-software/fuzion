# This file is part of the Fuzion language implementation.
#
# The Fuzion language implementation is free software: you can redistribute it
# and/or modify it under the terms of the GNU General Public License as published
# by the Free Software Foundation, version 3 of the License.
#
# The Fuzion language implementation is distributed in the hope that it will be
# useful, but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public
# License for more details.
#
# You should have received a copy of the GNU General Public License along with The
# Fuzion language implementation.  If not, see <https://www.gnu.org/licenses/>.


# -----------------------------------------------------------------------
#
#  Tokiwa Software GmbH, Germany
#
#  Source code of utility add_simple_test
#
# -----------------------------------------------------------------------

# convenience utility for adding a new simple test
#
add_simple_test is

  say "Name of the new test: "

  match (io.stdin.with ()->io.buffered.read_line)
    test String =>

      header(makefile bool) => """
        # This file is part of the Fuzion language implementation.
        #
        # The Fuzion language implementation is free software: you can redistribute it
        # and/or modify it under the terms of the GNU General Public License as published
        # by the Free Software Foundation, version 3 of the License.
        #
        # The Fuzion language implementation is distributed in the hope that it will be
        # useful, but WITHOUT ANY WARRANTY; without even the implied warranty of
        # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public
        # License for more details.
        #
        # You should have received a copy of the GNU General Public License along with The
        # Fuzion language implementation.  If not, see <https://www.gnu.org/licenses/>.


        # -----------------------------------------------------------------------
        #
        #  Tokiwa Software GmbH, Germany
        #
        #  Source code of Fuzion test{makefile ? " Makefile" : ""}
        #
        # -----------------------------------------------------------------------

      """

      makefile_body(test String) =>
        """
        override NAME = {test}
        include ../simple.mk
        """

      test_body(test String) =>
        """
        {test} is

        """

      if test.contains_whitespace
        say "name contains whitespace"
        exit 1
      if test.contains "/" || test.contains "\\"
        say "name contains slash"
        exit 1
      if io.file.exists "tests/$test"
        say "$test already exists."
        exit 1

      io.file.write.create_dir "tests/$test"
      io.file.use unit "tests/$test/$test.fz" io.file.mode.write (()->io.file.open.write ((header false)+(test_body test)).utf8)
      _ := io.file.use unit "tests/$test/Makefile" io.file.mode.write (()->io.file.open.write ((header true)+(makefile_body test)).utf8)

    e error => exit 1




